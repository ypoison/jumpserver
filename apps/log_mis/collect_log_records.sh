#!/bin/bash
platform='DaYun'
base_dir='/data/backup'
share_dir='/data/tmp'

#获取多少天内的日志信息
few_days=1

files=$(find ${base_dir} -type f -mtime -${few_days}|grep -v redis|grep -v mysql)
for f in ${files}
do
    md5=$(md5sum ${f}|awk {'print $1'})
    size=$(du -sh ${f}|awk {'print $1'})
    f=$(echo ${f}|sed "s!${base_dir}!${platform}!g")
    name=$(echo ${f}|awk -F / {'print $NF'})
    path=$(echo ${f%/*}/)
    l=${l}'{"'name'":"'${name}'","'path'":"'${path}'","'md5'":"'${md5}'","'size'":"'${size}'"},'
done
l=$(echo ${l}|sed 's/,$//')
l='{"'platform'":"'${platform}'","'data'":['${l}']}'
echo ${l}

#l='{"platform":"DaYun","data":[{"name":"gate_2019-10-12.log.zip","path":"DaYun/games_log/xinbainiu/gate/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"gate.log","path":"DaYun/games_log/xinbainiu/gate/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"gate_2019-11-11.log.zip","path":"DaYun/games_log/xinbainiu/gate/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playersettlelog_2019-10-12.log.zip","path":"DaYun/games_log/xinbainiu/playersettlelog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playersettlelog_2019-11-03.log.zip","path":"DaYun/games_log/xinbainiu/playersettlelog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playersettlelog.log","path":"DaYun/games_log/xinbainiu/playersettlelog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room.log","path":"DaYun/games_log/xinbainiu/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room_2019-11-11.log.zip","path":"DaYun/games_log/xinbainiu/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room_2019-10-12.log.zip","path":"DaYun/games_log/xinbainiu/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playerbetlog_2019-11-11.log.zip","path":"DaYun/games_log/xinbainiu/playerbetlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playerbetlog.log","path":"DaYun/games_log/xinbainiu/playerbetlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playerbetlog_2019-10-12.log.zip","path":"DaYun/games_log/xinbainiu/playerbetlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"gate_2019-10-12.log.zip","path":"DaYun/games_log/birdandbeast/gate/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"gate.log","path":"DaYun/games_log/birdandbeast/gate/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"gate_2019-11-11.log.zip","path":"DaYun/games_log/birdandbeast/gate/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playersettlelog_2019-10-12.log.zip","path":"DaYun/games_log/birdandbeast/playersettlelog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playersettlelog_2019-11-03.log.zip","path":"DaYun/games_log/birdandbeast/playersettlelog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playersettlelog.log","path":"DaYun/games_log/birdandbeast/playersettlelog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"openlog.log","path":"DaYun/games_log/birdandbeast/openlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"openlog_2019-10-12.log.zip","path":"DaYun/games_log/birdandbeast/openlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"openlog_2019-11-11.log.zip","path":"DaYun/games_log/birdandbeast/openlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room.log","path":"DaYun/games_log/birdandbeast/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room_2019-11-11.log.zip","path":"DaYun/games_log/birdandbeast/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room_2019-10-12.log.zip","path":"DaYun/games_log/birdandbeast/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playerbetlog_2019-11-03.log.zip","path":"DaYun/games_log/birdandbeast/playerbetlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playerbetlog.log","path":"DaYun/games_log/birdandbeast/playerbetlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"playerbetlog_2019-10-12.log.zip","path":"DaYun/games_log/birdandbeast/playerbetlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"gate_2019-10-12.log.zip","path":"DaYun/games_log/redpacket/gate/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"gate.log","path":"DaYun/games_log/redpacket/gate/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"gate_2019-11-11.log.zip","path":"DaYun/games_log/redpacket/gate/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room.log","path":"DaYun/games_log/redpacket/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room_2019-11-11.log.zip","path":"DaYun/games_log/redpacket/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room_2019-10-12.log.zip","path":"DaYun/games_log/redpacket/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"status.log","path":"DaYun/games_log/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"settlelog_2019-10-12.log.zip","path":"DaYun/games_log/qiangniu/settlelog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"settlelog_2019-11-03.log.zip","path":"DaYun/games_log/qiangniu/settlelog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"settlelog.log","path":"DaYun/games_log/qiangniu/settlelog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"betlog_2019-11-11.log.zip","path":"DaYun/games_log/qiangniu/betlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"betlog.log","path":"DaYun/games_log/qiangniu/betlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"betlog_2019-10-12.log.zip","path":"DaYun/games_log/qiangniu/betlog/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"stock.log","path":"DaYun/games_log/qiangniu/stock/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"stock_2019-11-03.log.zip","path":"DaYun/games_log/qiangniu/stock/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"stock_2019-10-12.log.zip","path":"DaYun/games_log/qiangniu/stock/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"gate_2019-10-12.log.zip","path":"DaYun/games_log/qiangniu/gate/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"gate.log","path":"DaYun/games_log/qiangniu/gate/","md5":"3650d5d25e86a3dfb6469dab069cecb5","size":"16K"},{"name":"gate_2019-11-11.log.zip","path":"DaYun/games_log/qiangniu/gate/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room.log","path":"DaYun/games_log/qiangniu/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room_2019-11-11.log.zip","path":"DaYun/games_log/qiangniu/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"room_2019-10-12.log.zip","path":"DaYun/games_log/qiangniu/room/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"zzl_2019-11-11.log.zip","path":"DaYun/games_log/zzl/zzlserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"zzl_2019-10-12.log.zip","path":"DaYun/games_log/zzl/zzlserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":".log","path":"DaYun/games_log/zzl/zzlserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"dataserver_2019-11-11.log.zip","path":"DaYun/games_log/zzl/dataserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"dataserver.log","path":"DaYun/games_log/zzl/dataserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"dataserver_2019-10-12.log.zip","path":"DaYun/games_log/zzl/dataserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"dataserver_2019-11-11.log.zip","path":"DaYun/games_log/lottery/dataserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"dataserver.log","path":"DaYun/games_log/lottery/dataserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"dataserver_2019-10-12.log.zip","path":"DaYun/games_log/lottery/dataserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"lottery_2019-10-12.log.zip","path":"DaYun/games_log/lottery/lottery/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"lottery.log","path":"DaYun/games_log/lottery/lottery/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"lottery_2019-11-11.log.zip","path":"DaYun/games_log/lottery/lottery/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"test1.log","path":"DaYun/","md5":"e83b40511b7b154b1816ef4c03d6be7d","size":"1.3G"},{"name":"rsync.log","path":"DaYun/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"base.2019-11-12.log","path":"DaYun/Api_log/hadmin/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"base.2019-10-11.log","path":"DaYun/Api_log/hadmin/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-10-11.0.log","path":"DaYun/Api_log/pay/2019-10-11/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.log","path":"DaYun/Api_log/pay/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-11-10.0.log","path":"DaYun/Api_log/pay/2019-11-10/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"status.log","path":"DaYun/Api_log/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-11-11.0.log","path":"DaYun/Api_log/consumer/2019-11-11/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-10-11.0.log","path":"DaYun/Api_log/consumer/2019-10-11/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.log","path":"DaYun/Api_log/consumer/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-11-11.0.log","path":"DaYun/Api_log/provider/2019-11-11/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-10-11.0.log","path":"DaYun/Api_log/provider/2019-10-11/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.log","path":"DaYun/Api_log/provider/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-10-15.0.log","path":"DaYun/Api_log/apiGateway/2019-10-15/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-10-11.0.log","path":"DaYun/Api_log/apiGateway/2019-10-11/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.log","path":"DaYun/Api_log/apiGateway/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-11-11.0.log","path":"DaYun/Hall_log/consumer/2019-11-11/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-10-11.0.log","path":"DaYun/Hall_log/consumer/2019-10-11/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.log","path":"DaYun/Hall_log/consumer/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-11-11.0.log","path":"DaYun/Hall_log/lobby/2019-11-11/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-10-11.0.log","path":"DaYun/Hall_log/lobby/2019-10-11/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.log","path":"DaYun/Hall_log/lobby/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.2019-11-11.0.log","path":"DaYun/Hall_log/provider/2019-11-11/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"info.log","path":"DaYun/Hall_log/provider/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"db_2019-10-11.log.zip","path":"DaYun/Dbserver_log/dbserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"db.log","path":"DaYun/Dbserver_log/dbserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"db_2019-11-11.log.zip","path":"DaYun/Dbserver_log/dbserver/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"},{"name":"status.log","path":"DaYun/Dbserver_log/","md5":"f332ff302ae3576b1a498d035dc54e4e","size":"24K"},{"name":"test.log","path":"DaYun/","md5":"e5c834fbdaa6bfd8eac5eb9404eefdd4","size":"1001M"},{"name":"logdown_cgi.log","path":"DaYun/","md5":"d41d8cd98f00b204e9800998ecf8427e","size":"0"}]}'

curl -X POST \
-H 'Authorization: Token 700987c7e556d59521d61588881cbcc505a53ed2' \
-H "Content-Type:application/json" \
http://192.168.1.169/api/log-mis/v1/records/update/ -d ${l}